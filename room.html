<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ë°©íƒˆì¶œ ê²Œì„!</title>
    
    <style>
        /* CSS ì½”ë“œ ì‹œì‘ */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Malgun Gothic', 'Segoe UI', sans-serif;
            overflow: hidden; /* ìŠ¤í¬ë¡¤ë°” ì˜êµ¬ ì œê±° */
        }

        /* --- ì‹œì‘ í™”ë©´ --- */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #3c3c3c 0%, #000000 100%);
            display: flex; justify-content: center; align-items: center;
            z-index: 300;
        }
        .start-box {
            background-color: rgba(255, 255, 255, 0.95);
            color: #333; padding: 30px 40px; border-radius: 15px;
            text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .start-box h1 { margin-top: 0; color: #333; }
        .start-box input { display: block; width: 90%; margin: 15px auto; padding: 12px; font-size: 1em; border: 1px solid #ccc; border-radius: 5px; }
        #start-button {
            width: 95%; padding: 12px; font-size: 1.2em; font-weight: bold; background-color: #007bff; color: white;
            border: none; border-radius: 5px; cursor: pointer; margin-top: 10px; transition: background-color 0.3s;
        }
        #start-button:hover { background-color: #0056b3; }
        
        /* --- ê²Œì„ ì›”ë“œ (ì „ì²´ í™”ë©´ ë°°ê²½) --- */
        #game-world { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        #background-image { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.5s ease-in-out; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; }

        /* --- UI ìš”ì†Œ --- */
        #game-header { position: absolute; top: 15px; width: 100%; text-align: center; color: white; text-shadow: 2px 2px 6px black; }
        #game-title { margin: 0; font-size: 1.2em; }
        #timer-display { font-size: 2.8em; font-weight: bold; color: #ffc107; }

        @keyframes highlight-effect {
            0%   { background-color: rgba(255, 255, 0, 0.5); border: 2px solid yellow; }
            50%  { background-color: rgba(255, 255, 0, 0.2); border: 2px solid rgba(255, 255, 0, 0.5); }
            100% { background-color: rgba(255, 255, 0, 0.5); border: 2px solid yellow; }
        }
        .hotspot { position: absolute; cursor: pointer; border-radius: 8px; animation: highlight-effect 1.8s infinite ease-in-out; }
        
        /* ìŠ¤í…Œì´ì§€ 1 í•«ìŠ¤íŒŸ */
        [data-item="license-plate"] { top: 70%; left: 47.5%; width: 9%; height: 5%; }
        [data-item="floor-sign"]    { top: 30%; left: 78%; width: 4%; height: 11%; }
        [data-item="car"]           { top: 48%; left: 29%; width: 48%; height: 26%; }
        
        /* ìŠ¤í…Œì´ì§€ 2 í•«ìŠ¤íŒŸ */
        [data-item="bag"]           { top: 67%; left: 40%; width: 14%; height: 18%; }
        [data-item="mannequin"]     { top: 32%; left: 14%; width: 13%; height: 52%; }
        [data-item="stage2-window"] { top: 29%; left: 63%; width: 23%; height: 35%; }

        /* ìë¬¼ì‡  ì•„ì´ì½˜ (ë” í¬ê²Œ ìˆ˜ì •) */
        #lock-icon {
            position: absolute; bottom: 25px; right: 25px;
            width: 80px; height: 80px; /* í¬ê¸° ì¦ê°€ */
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM9 8V6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9z"/></svg>') no-repeat center center;
            background-size: 65%;
            background-color: rgba(0,0,0,0.6); border-radius: 50%;
            cursor: pointer; transition: transform 0.2s;
        }
        #lock-icon:hover { transform: scale(1.1); }

        /* --- ìŠ¤í…Œì´ì§€ 3: ë³´ìŠ¤ì „ --- */
        #monster-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center;
        }
        #monster-image {
            width: 350px; /* ê´´ë¬¼ í¬ê¸° ì¦ê°€ */
            max-width: 70vw; /* í™”ë©´ ë„ˆë¹„ì— ë”°ë¼ ì¡°ì ˆ */
            filter: drop-shadow(5px 5px 15px rgba(0,0,0,0.7)); /* ê·¸ë¦¼ì íš¨ê³¼ ì¶”ê°€ */
        }
        #monster-hp-bar-bg { width: 100%; height: 20px; background-color: #555; border-radius: 10px; border: 2px solid #333; margin-top: 10px; }
        #monster-hp-bar { height: 100%; width: 100%; background-color: #dc3545; border-radius: 8px; transition: width 0.5s ease; }
        
        #sword-button {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 90px; height: 90px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48" fill="white"><path d="m280-120-43-43 22-22q-27-28-27-64.5t27-64.5l311-311-39-39q-12-12-18-28.5t-6-34.5q0-31 21.5-52.5T600-760q18 0 34.5 6t28.5 18l39 39 311-311q27-27 64.5-27t64.5 27l43 43q27 27 27 64.5T1153-807L842-496l39 39q12 12 18 28.5t6 34.5q0 31-21.5 52.5T800-280q-18 0-34.5-6T737-304l-39-39-311 311q-27 27-64.5 27T280-120Z"/></svg>') no-repeat center center;
            background-size: 60%;
            background-color: #c82333; border: 3px solid #ffc107;
            border-radius: 50%; cursor: pointer; transition: transform 0.1s;
        }
        #sword-button:active { transform: translateX(-50%) scale(0.9); }

        /* --- ëª¨ë‹¬ ê³µí†µ --- */
        .modal { position: fixed; z-index: 200; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; }
        .modal-content { background: white; color: #333; padding: 25px; border-radius: 10px; text-align: center; width: 90%; max-width: 480px; }
        .hidden { display: none !important; }
        .modal-content button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 5px 0 5px; font-size: 1em; }
        .close-button { background-color: #ccc; }
        #password-submit, .puzzle-button { background-color: #007bff; color: white; }
        .modal-content input { padding: 10px; width: 80%; text-align: center; font-size: 1.2em; border: 1px solid #ccc; border-radius: 5px; }
        
        #memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px auto; }
        .card { width: 100%; aspect-ratio: 1 / 1; background-color: #17a2b8; border-radius: 5px; display: flex; justify-content: center; align-items: center; font-size: 2rem; cursor: pointer; transform-style: preserve-3d; transition: transform 0.5s; }
        .card .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; }
        .card .card-front { transform: rotateY(180deg); }
        .card.is-flipped { transform: rotateY(180deg); }
        .card.is-matched { background-color: #28a745; cursor: default; transform: rotateY(180deg); }
    </style>
</head>
<body>
    
    <div id="start-screen">
        <div class="start-box">
            <h1>ë°©íƒˆì¶œ ê²Œì„</h1>
            <input type="text" id="input-grade" placeholder="í•™ë…„">
            <input type="text" id="input-class" placeholder="ë°˜">
            <input type="text" id="input-name" placeholder="ì´ë¦„">
            <button id="start-button">ê²Œì„ ì‹œì‘</button>
        </div>
    </div>
    
    <div id="game-world" class="hidden">
        <img id="background-image" src="" alt="ê²Œì„ ë°°ê²½">
        <div id="ui-layer">
            <div id="game-header">
                <h1 id="game-title"></h1>
                <div id="timer-display"></div>
            </div>
            
            <div class="hotspot stage-1" data-item="license-plate"></div>
            <div class="hotspot stage-1" data-item="floor-sign"></div>
            <div class="hotspot stage-1" data-item="car"></div>
            
            <div class="hotspot stage-2 hidden" data-item="bag"></div>
            <div class="hotspot stage-2 hidden" data-item="mannequin"></div>
            <div class="hotspot stage-2 hidden" data-item="stage2-window"></div>
            
            <div id="monster-container" class="stage-3 hidden">
                <img id="monster-image" src="https://i.postimg.cc/jdLJ7B5Z/Whisk-f3693af008.jpg" alt="ê´´ë¬¼">
                <div id="monster-hp-bar-bg"><div id="monster-hp-bar"></div></div>
            </div>
            <button id="sword-button" class="stage-3 hidden"></button>
            
            <div id="lock-icon"></div>
        </div>
    </div>

    <div id="puzzle-modal" class="modal hidden">
        <div class="modal-content"><div id="puzzle-area"></div><button class="close-button">ë‹«ê¸°</button></div>
    </div>
    <div id="password-modal" class="modal hidden">
        <div class="modal-content">
            <h3 id="password-title">ìë¬¼ì‡  ë¹„ë°€ë²ˆí˜¸</h3>
            <input type="text" id="password-input" placeholder="3ìë¦¬ ìˆ«ì" maxlength="3" pattern="\d*">
            <button id="password-submit">ì—´ê¸°</button><button class="close-button">ì·¨ì†Œ</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            let timerInterval;
            let timeLeft;

            const DOM = {
                startScreen: document.getElementById('start-screen'),
                startButton: document.getElementById('start-button'),
                gameWorld: document.getElementById('game-world'),
                gameTitle: document.getElementById('game-title'),
                inputGrade: document.getElementById('input-grade'),
                inputClass: document.getElementById('input-class'),
                inputName: document.getElementById('input-name'),
                timerDisplay: document.getElementById('timer-display'),
                backgroundImage: document.getElementById('background-image'),
                uiLayer: document.getElementById('ui-layer'),
                hotspots: document.querySelectorAll('.hotspot'),
                lockIcon: document.getElementById('lock-icon'),
                puzzleModal: document.getElementById('puzzle-modal'),
                passwordModal: document.getElementById('password-modal'),
                puzzleArea: document.getElementById('puzzle-area'),
                passwordInput: document.getElementById('password-input'),
                passwordTitle: document.getElementById('password-title'),
                passwordSubmit: document.getElementById('password-submit'),
                swordButton: document.getElementById('sword-button'),
                monsterHpBar: document.getElementById('monster-hp-bar'),
            };

            const gameState = {
                currentStage: 1,
                stages: {
                    1: {
                        background: 'https://i.postimg.cc/X70TG6Q0/Whisk-88f2c3b18b.jpg',
                        password: '140', solvedPuzzles: new Set(),
                        puzzles: {
                            'license-plate': { title: 'ë²ˆí˜¸íŒ í€´ì¦ˆ', question: "ì°¨ëŸ‰ ë²ˆí˜¸íŒ '3140'ì˜ ë§ˆì§€ë§‰ ì„¸ ìë¦¬ ìˆ«ìëŠ”?", answer: '140', hint: "ë¹„ë°€ë²ˆí˜¸ì˜ ë’¤ ì„¸ ìë¦¬ëŠ” [ 140 ] ì´ë‹¤." },
                            'floor-sign': { title: 'ì¸µìˆ˜ ì•ˆë‚´íŒ', question: "ì•ˆë‚´íŒì— B1ì´ë¼ê³  ì í˜€ìˆë‹¤. ì—¬ê¸°ì„œ ì–»ì„ ìˆ˜ ìˆëŠ” ìˆ«ìëŠ”?", answer: '1', hint: "ë¹„ë°€ë²ˆí˜¸ì˜ ì²« ë²ˆì§¸ ìˆ«ìëŠ” [ 1 ] ì´ë‹¤." },
                            'car': { type: 'hint', title: "ìë™ì°¨ ì°½ë¬¸", text: "ìë™ì°¨ ì°½ë¬¸ì— í¬ë¯¸í•˜ê²Œ ìˆ«ì '0'ì´ ë³´ì¸ë‹¤.", hint: "ë¹„ë°€ë²ˆí˜¸ì˜ ë§ˆì§€ë§‰ ìˆ«ìëŠ” [ 0 ] ì´ë‹¤."}
                        }
                    },
                    2: {
                        background: 'https://i.postimg.cc/TPhSMdYn/Whisk-dcc062bcdb.jpg',
                        password: '729', solvedPuzzles: new Set(),
                        puzzles: {
                            'bag': { title: 'ê°€ë°© ê°€ê²©í‘œ', question: "ê°€ë°©ì— ë¶™ì€ íƒœê·¸ì— '70% SALE'ì´ë¼ê³  ì í˜€ìˆë‹¤. ì—¬ê¸°ì„œ ê°€ì¥ í° ìˆ«ìëŠ”?", answer: '7', hint: "ë¹„ë°€ë²ˆí˜¸ì˜ ì²« ìˆ«ìëŠ” [ 7 ] ì´ë‹¤." },
                            'mannequin': { title: 'ë§ˆë„¤í‚¹', question: "ì´ ë§ˆë„¤í‚¹ì€ íŒ”ì´ 2ê°œ, ë‹¤ë¦¬ê°€ 2ê°œ ìˆë‹¤. íŒ”ì˜ ê°œìˆ˜ëŠ”?", answer: '2', hint: "ë¹„ë°€ë²ˆí˜¸ì˜ ë‘ ë²ˆì§¸ ìˆ«ìëŠ” [ 2 ] ì´ë‹¤." },
                            'stage2-window': { type: 'memory', title: 'ì°½ë¬¸ ë„ˆë¨¸', hint: "ë¹„ë°€ë²ˆí˜¸ì˜ ë§ˆì§€ë§‰ ìˆ«ìëŠ” [ 9 ] ì´ë‹¤."}
                        }
                    },
                    3: {
                        background: 'https://i.postimg.cc/028V1kVr/Whisk-8c9c1d8c9b.jpg',
                        monsterMaxHp: 5, monsterCurrentHp: 5
                    }
                }
            };
            
            DOM.startButton.addEventListener('click', startGame);
            DOM.hotspots.forEach(hotspot => hotspot.addEventListener('click', handleHotspotClick));
            DOM.lockIcon.addEventListener('click', () => DOM.passwordModal.classList.remove('hidden'));
            document.querySelectorAll('.close-button').forEach(btn => btn.addEventListener('click', closeAllModals));
            DOM.passwordSubmit.addEventListener('click', checkFinalPassword);
            DOM.swordButton.addEventListener('click', attackMonster);

            function startGame() {
                const grade = DOM.inputGrade.value.trim();
                const studentClass = DOM.inputClass.value.trim();
                const name = DOM.inputName.value.trim();
                if (!grade || !studentClass || !name) {
                    alert('í•™ë…„, ë°˜, ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return;
                }
                DOM.gameTitle.textContent = `${grade}í•™ë…„ ${studentClass}ë°˜ ${name}ì˜ íƒˆì¶œ!`;
                DOM.startScreen.classList.add('hidden');
                DOM.gameWorld.classList.remove('hidden');
                setupStage(1);
            }

            function setupStage(stageNum) {
                gameState.currentStage = stageNum;
                const stageData = gameState.stages[stageNum];
                
                DOM.backgroundImage.style.opacity = 0;
                setTimeout(() => {
                    DOM.backgroundImage.src = stageData.background;
                    DOM.backgroundImage.style.opacity = 1;
                }, 500);

                const isBossStage = (stageNum === 3);
                DOM.lockIcon.classList.toggle('hidden', isBossStage);
                DOM.timerDisplay.classList.toggle('hidden', isBossStage);
                
                DOM.uiLayer.querySelectorAll('.stage-1, .stage-2, .stage-3').forEach(el => el.classList.add('hidden'));

                if(isBossStage){
                    DOM.uiLayer.querySelectorAll('.stage-3').forEach(el => el.classList.remove('hidden'));
                } else {
                    DOM.passwordTitle.textContent = `ìŠ¤í…Œì´ì§€ ${stageNum} ìë¬¼ì‡ `;
                    DOM.uiLayer.querySelectorAll(`.stage-${stageNum}`).forEach(spot => {
                        spot.classList.remove('hidden');
                        spot.style.display = stageData.solvedPuzzles.has(spot.dataset.item) ? 'none' : 'block';
                    });
                    startTimer(300); // 5ë¶„
                }
            }

            function startTimer(duration) {
                if (timerInterval) clearInterval(timerInterval);
                timeLeft = duration;
                updateTimerDisplay();
                timerInterval = setInterval(updateTimerDisplay, 1000);
            }

            function updateTimerDisplay() {
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert('ì‹œê°„ ì´ˆê³¼! íƒˆì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    window.location.reload();
                    return;
                }
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                DOM.timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }

            function handleHotspotClick(e) {
                const item = e.target.dataset.item;
                const stageData = gameState.stages[gameState.currentStage];
                if (stageData.solvedPuzzles.has(item)) return;
                createPuzzleFor(item, stageData.puzzles[item]);
            }

            function createPuzzleFor(item, puzzleData) {
                DOM.puzzleArea.innerHTML = '';
                if(puzzleData.type === 'hint'){
                    createHint(item, puzzleData);
                } else if (puzzleData.type === 'memory'){
                    createMemoryGame(item, puzzleData);
                } else {
                    createQuiz(item, puzzleData);
                }
                DOM.puzzleModal.classList.remove('hidden');
            }
            
            function createHint(item, data){
                 DOM.puzzleArea.innerHTML = `<h3>${data.title}</h3><p>${data.text}</p>`;
                 solvePuzzle(item, data.hint);
            }

            function createQuiz(item, data){
                 DOM.puzzleArea.innerHTML = `<h3>${data.title}</h3><p>${data.question}</p><input type="text" id="quiz-answer" placeholder="ì •ë‹µ ì…ë ¥"><button class="puzzle-button" id="quiz-submit">í™•ì¸</button>`;
                 document.getElementById('quiz-submit').addEventListener('click', () => {
                     if (document.getElementById('quiz-answer').value.trim() === data.answer) {
                         solvePuzzle(item, data.hint);
                     } else { alert('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”!'); }
                 });
            }

            function createMemoryGame(item, data) {
                DOM.puzzleArea.innerHTML = `<h3>${data.title}</h3><p>ê°™ì€ ì•„ì´ì½˜ì˜ ì¹´ë“œë¥¼ ë§ì¶”ì„¸ìš”.</p><div id="memory-grid"></div>`;
                const grid = document.getElementById('memory-grid');
                const icons = ['ğŸ”‘', 'ğŸ”’', 'ğŸ’¡', 'ğŸšª', 'ğŸ”‘', 'ğŸ”’', 'ğŸ’¡', 'ğŸšª'];
                icons.sort(() => 0.5 - Math.random());
                let flippedCards = [], matchedPairs = 0;
                icons.forEach(icon => {
                    const card = document.createElement('div'); card.classList.add('card'); card.dataset.icon = icon;
                    card.innerHTML = `<div class="card-face card-back"></div><div class="card-face card-front">${icon}</div>`;
                    card.addEventListener('click', () => {
                        if (flippedCards.length < 2 && !card.classList.contains('is-flipped')) {
                            card.classList.add('is-flipped'); flippedCards.push(card);
                            if (flippedCards.length === 2) {
                                setTimeout(() => {
                                    const [card1, card2] = flippedCards;
                                    if (card1.dataset.icon === card2.dataset.icon) {
                                        card1.classList.add('is-matched'); card2.classList.add('is-matched');
                                        matchedPairs++;
                                        if (matchedPairs === icons.length / 2) setTimeout(() => solvePuzzle(item, data.hint), 300);
                                    } else {
                                        card1.classList.remove('is-flipped'); card2.classList.remove('is-flipped');
                                    }
                                    flippedCards = [];
                                }, 600);
                            }
                        }
                    });
                    grid.appendChild(card);
                });
            }

            function solvePuzzle(item, hint) {
                alert(`íŒíŠ¸ íšë“: ${hint}`);
                const stageData = gameState.stages[gameState.currentStage];
                stageData.solvedPuzzles.add(item);
                document.querySelector(`.hotspot[data-item="${item}"]`).style.display = 'none';
                closeAllModals();
            }

            function checkFinalPassword() {
                const stageData = gameState.stages[gameState.currentStage];
                if (DOM.passwordInput.value === stageData.password) {
                    clearInterval(timerInterval);
                    if (gameState.currentStage < 2) {
                        alert('ì •ë‹µì…ë‹ˆë‹¤! ë‹¤ìŒ ì¥ì†Œë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                        DOM.passwordInput.value = ''; closeAllModals();
                        setupStage(gameState.currentStage + 1);
                    } else if (gameState.currentStage === 2) {
                        alert('ì •ë‹µì…ë‹ˆë‹¤! ë§ˆì§€ë§‰ ì¥ì†Œë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                        DOM.passwordInput.value = ''; closeAllModals();
                        setupStage(3);
                    }
                } else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.'); }
            }
            
            function attackMonster(){
                const stageData = gameState.stages[3];
                stageData.monsterCurrentHp--;
                const hpPercent = (stageData.monsterCurrentHp / stageData.monsterMaxHp) * 100;
                DOM.monsterHpBar.style.width = `${hpPercent}%`;
                
                if(stageData.monsterCurrentHp <= 0){
                    DOM.swordButton.classList.add('hidden');
                    setTimeout(() => {
                        alert('ê´´ë¬¼ì„ ë¬¼ë¦¬ì³¤ë‹¤! ìµœì¢… íƒˆì¶œ ì„±ê³µ!');
                        DOM.gameWorld.innerHTML = `<div style="width:100%; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center; background: #000;">
                            <h1 style="font-size:2.5em; color:white;">ê²Œì„ í´ë¦¬ì–´!</h1>
                            <p style="text-align:center; font-size: 1.2em; color:white;">${DOM.gameTitle.textContent}</p>
                        </div>`;
                    }, 500);
                }
            }

            function closeAllModals() {
                DOM.puzzleModal.classList.add('hidden');
                DOM.passwordModal.classList.add('hidden');
            }
        });
    </script>
</body>
</html>```